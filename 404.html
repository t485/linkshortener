<html>

<head>
    <title>T485 Link Shortener | Loading link...</title>
</head>

<body>
<h1>Loading...</h1>
<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-database.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyB-ly8ax35aWTAGhX2UDVuYxPSDlAU8kMk",
        authDomain: "t485-main.firebaseapp.com",
        databaseURL: "https://t485-main.firebaseio.com",
        projectId: "t485-main",
        storageBucket: "t485-main.appspot.com",
        messagingSenderId: "368513727602"
    };
    firebase.initializeApp(config);
</script>
<script>
    var errorTemplate = `
                <html><head>
                <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
                </head><body>
                <div class="container">
                    <div class="col-lg-12">
                        <h1>404 Error: File not found</h1>
                        <p class="text-muted">T485 Link Shortener</p>
                        <hr>
                        <p>The link you have tried to access does not exist. <a href="/">You may be able to create this link at the home page.</a>
                        Please note that some links cannot be created, even if they do not already exist.
                         <br>
                         If you believe this is an error, please contact the webmaster (<a href="mailto:webmaster@t485.org">webmaster@t485.org).</p>

                    </div>
                </div>
        `;

    if (window.location.pathname.substring(1) !== "") {
        firebase.database().ref("/links/root/" + encodeURIComponent(window.location.pathname.substring(1)) + "/link/").once("value").then(function (snapshot) {
            var data = snapshot.val();
            console.log(data);
            if (data && data.text && !data.reserved && !data.disabled) {//false for reserved words
                window.location.href = data.text;
            } else {
                document.open();//clears everything
                document.write(errorTemplate);
            }
        });
    } else {
        document.open();//clears everything

        document.write(errorTemplate);
    }

</script>

</body>

</html>